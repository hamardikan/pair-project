<%- include('../partials/head') %>
<%- include('../partials/navbar') %>

<div class="max-w-4xl mx-auto px-4 py-10">
  <% posts.forEach(post => { %>
    <article class="mb-16">
      <!-- Author Info -->
      <div class="flex items-center space-x-4 mb-8">
        <img class="h-12 w-12 rounded-full"
          src="<%= post.User.Profile?.avatarUrl || Helper.getDefaultAvatar(post.User.username) %>"
          alt="<%= post.User.username %>">
        <div>
          <h3 class="font-medium"><%= post.User.username %></h3>
          <div class="flex items-center text-sm text-gray-500 space-x-2">
            <time datetime="<%= post.createdAt %>"><%= Helper.formatDate(post.createdAt) %></time>
            <span>Â·</span>
            <span><%= Helper.calculateReadTime(post.content) %></span>
          </div>
        </div>
        <% if (locals.user && locals.user.id === post.userId) { %>
          <div class="ml-auto flex space-x-2">
            <a href="/posts/<%= post.id %>/edit"
              class="px-4 py-2 text-sm text-gray-600 hover:text-gray-900">
              Edit
            </a>
            <a href="/posts/<%= post.id %>/delete"
              class="px-4 py-2 text-sm text-red-600 hover:text-red-900"
              onclick="return confirm('Are you sure you want to delete this post?')">
              Delete
            </a>
          </div>
        <% } %>
      </div>

      <!-- Post Content -->
      <h1 class="text-5xl font-bold serif-pro mb-8"><%= post.title %></h1>
      <div class="prose prose-lg max-w-none">
        <%- Helper.sanitizeHtml(post.content) %>
      </div>

      <!-- Tags -->
      <div class="mt-8 flex flex-wrap gap-2">
        <% post.Tags.forEach(tag => { %>
          <a href="/tags/<%= tag.id %>"
            class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-600">
            #<%= tag.name %>
          </a>
        <% }) %>
      </div>
    </article>
  <% }) %>
</div>

<%- include('../partials/footer') %>